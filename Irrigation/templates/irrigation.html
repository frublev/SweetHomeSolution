{% extends "base.html" %}

{% block content %}

<h6 class="display-6">Irrigation areas</h6>

<table class="table table-borderless">
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">Area</th>
      <th scope="col">Status</th>
      <th scope="col">Auto</th>
      <th scope="col">Frequency</th>
      <th scope="col">Duration</th>
    </tr>
  </thead>

  <tbody>
  {% for area in layout %}
    <tr>
      <td>{{ area['id'] }}</td>
      <td><a href='/irrigation/{{ area.id }}/' class="link-success">{{ area['head'] }}</a></td>
      <td>
        <div class="form-check form-switch">
          <input class="form-check-input"
                 type="checkbox"
                 role="switch"
                 name="area_status"
                 id="area_on_off{{ area['id'] }}"
                 onclick="area_status('{{ area.id }}', 'on_off')"
                 value="{{ area['on_off'] }}">
          <label id = "check_area_on_off{{ area['id'] }}" class="form-check-label" for="area_on_off{{ area['id'] }}">checked</label>
        </div>
      </td>
      <td>
        <div class="form-check form-switch">
          <input class="form-check-input"
                 type="checkbox"
                 role="switch"
                 name="area_auto"
                 id="area_auto{{ area['id'] }}"
                 onclick="area_status('{{ area.id }}', 'auto')"
                 value="{{ area['auto'] }}">
          <label id = "check_area_auto{{ area['id'] }}" class="form-check-label" for="area_auto{{ area['id'] }}">checked</label>
        </div>
      </td>

    </tr>
  {% endfor %}
</table>

<div id="layout" style="display: none;">{{ layout }}</div>

<!--<script>-->
<!--  radio_check('area_status');-->
<!--  radio_check('area_auto');-->

<!--  function radio_check(elbyname) {-->
<!--    let elements = document.getElementsByName(elbyname);-->
<!--    for (let i = 0; i < elements.length; i++) {-->
<!--      let lab = 'check_' + elements[i].id + '';-->
<!--      if (elements[i].value == "True") {-->
<!--        elements[i].checked = true;-->
<!--        document.getElementById(lab).innerText = 'On';-->
<!--      }-->
<!--      else {-->
<!--        elements[i].checked = false;-->
<!--        document.getElementById(lab).innerText = 'Off';-->
<!--      }-->
<!--    }-->
<!--  }-->

<!--  const area_status = async (area_ = '', radio = '') => {-->
<!--    let url = '/irrigation/' + area_ + '/';-->
<!--    let area_id = 'area_' + radio + area_;-->
<!--    let status = document.getElementById(area_id).value;-->
<!--    let lab_ = 'check_area_' + radio + area_;-->
<!--    let data = {}-->

<!--    if (status == "True") {-->
<!--      data[radio] = false;-->
<!--    }-->
<!--    else {-->
<!--      data[radio] = true;-->
<!--    }-->

<!--    const response = await fetch(url, {-->
<!--      method: 'PATCH',-->
<!--      headers: {'Content-Type': 'application/json'},-->
<!--      body: JSON.stringify(data)-->
<!--    });-->
<!--    let area_status = await response.json();-->
<!--    if (area_status.status == true) {-->
<!--      document.getElementById(area_id).value = "True";-->
<!--      document.getElementById(lab_).innerText = "On";-->
<!--    }-->
<!--    else {-->
<!--      document.getElementById(area_id).value = "False";-->
<!--      document.getElementById(lab_).innerText = "Off";-->
<!--    }-->
<!--    return;-->
<!--  }-->
<!--</script>-->

{% endblock %}
